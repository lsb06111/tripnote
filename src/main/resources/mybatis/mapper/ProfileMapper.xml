<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="edu.example.tripnote.dao.ProfileDAO">

<!-- 타이틀 찾기 -->
<select id="title" resultType="string" parameterType="CourseDTO">
   select title
   from course
   where id = #{id}
</select>

<!-- 여행 기간 (endDate - startDate) -->
<select id="day" resultType="string" parameterType="CourseDTO">
	select startDate, endDate
	from course
	where id = #{id}
</select>

<!-- 관광지 명 찾기 -->
<select id="area" resultType="string" parameterType="AreaVO">
	select areaName
	from area
	where id = #{id}
</select>

<select id="getAllCourse" parameterType="_int" resultType="CourseDTO">
	select * from course where user_id = #{userId} and is_visible = 1 order by id desc
</select>

<select id="getArea" resultType="AreaVO" parameterType="_int">
	select * from area where id = #{areaId}
</select>

<select id="getIcon" resultType="string" parameterType="long">
	select icon_name from course_icon where course_id = #{courseId}
</select>

<insert id="insertIcon" parameterType="CourseIconDTO">
	insert into course_icon values (#{courseId}, #{iconName})
</insert>

<update id="updateIcon" parameterType="CourseIconDTO">
	update course_icon set icon_name = #{iconName} where course_id = #{courseId}
</update>

<update id="updateTitle" parameterType="CourseDTO">
	update course set title =#{title} where id = #{id}
</update>

<update id="updateEmail" parameterType="UserDTO">
	update users set email= #{email} where id = #{id}
</update>

<update id="updatePassword" parameterType="UserDTO">
	update users set password = #{password} where id = #{id}
</update>

<update id="updateNickname" parameterType="UserDTO">
	update users set nickname= #{nickname} where id = #{id}
</update>
 
<select id="getUser" parameterType="string" resultType="UserDTO">
	select * from users where username = #{username}
</select>

<select id="findUsers" resultType="UserDTO">
	select * from users where (username like '%'||#{target}||'%' or nickname like '%'||#{target}||'%') and id != #{curUserId}
</select>

<update id="updateProfileImg">
	update users set profile_image = #{profileImage} where id = #{id}
</update>

<select id="getAllTourLoc" resultType="TourLocDTO">
	select * from tour_loc where course_id = #{id} order by tour_nth, tour_order
</select>

<select id="getTourLoc" parameterType="_int" resultType="TourLocDTO">
	select * from tour_loc where id = #{id}
</select>

<update id="updateRecommend" parameterType="TourLocDTO">
    UPDATE tour_loc
    SET is_recommend = #{isRecommend}
    WHERE id = #{id}
</update>

<update id="deleteCourse" parameterType="_int">
	update course set is_visible = 0 where id = #{id}
</update>

<select id="getCourseBoardIds" parameterType="int" resultType="BoardCourseDTO">
	select id, course_id from board where user_id = #{id}
</select>

<select id="getFollowers" parameterType="int" resultType="UserDTO">
	select u.* from users u where u.id in (select follow_id from follow f where f.user_id = #{userId})
</select>

<select id="getFollowings" parameterType="int" resultType="UserDTO">
	select u.* from users u where u.id in (select user_id from follow f where f.follow_id = #{userId})
</select>
</mapper>